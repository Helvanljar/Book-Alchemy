<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>The Digital Library</title>

  <!-- Styles and scripts -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script defer src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
  <!-- Sidebar menu -->
  <aside class="sidebar">
    <h2>Menu</h2>

    <div class="toggle-wrapper">
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
      <span>Dark Mode</span>
    </div>

    <button class="btn" onclick="openModal('authorListModal')">ðŸ“š Authors</button>
    <button class="btn" onclick="openModal('addBookModal')">âž• Add Book</button>
    <button class="btn" onclick="openModal('addAuthorModal')">ðŸ‘¤ Add Author</button>
    <button class="btn" id="recommendOpen">âœ¨ Recommend</button>
  </aside>

  <main class="main">
    <h1>The Digital Library</h1>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Search + Sort form -->
    <form class="search-bar" method="get" action="{{ url_for('home') }}">
      <div class="search-input-wrapper">
        <input type="text" name="q" placeholder="ðŸ”Ž Search books or authors..."
               value="{{ search_query or '' }}">
        <button type="submit" class="btn primary">Search</button>
      </div>

      <select name="sort" onchange="this.form.submit()">
        <option value="title" {% if sort_by=='title' %}selected{% endif %}>Sort by Title</option>
        <option value="author" {% if sort_by=='author' %}selected{% endif %}>Sort by Author</option>
        <option value="year" {% if sort_by=='year' %}selected{% endif %}>Sort by Year</option>
        <option value="rating" {% if sort_by=='rating' %}selected{% endif %}>Sort by Rating</option>
      </select>
    </form>

    <section class="book-grid">
      {% if books %}
        {% for book in books %}
          <article class="book-card" onclick="openModal('bookModal{{ book.id }}')">
            <img src="{{ book.cover_url if book.cover_url and book.cover_url.strip() else url_for('static', filename='default_cover.jpg') }}"
                 onerror="this.onerror=null;this.src='{{ url_for('static', filename='default_cover.jpg') }}'"
                 alt="Cover of {{ book.title }}">
            <h3>{{ book.title }}</h3>
            <p>{{ book.author.name }}</p>
          </article>
          {% include 'book_detail.html' %}
        {% endfor %}
      {% else %}
        <p class="loading-text">No books found.</p>
      {% endif %}
    </section>
  </main>

  {% include 'author_list.html' %}
  {% include 'add_book.html' %}
  {% include 'add_author.html' %}
  {% include 'recommend.html' %}

  <div id="toast"></div>
</body>
</html>
